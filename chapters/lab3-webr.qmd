---
title: "Lab 3: ANOVA - WebR Practice"
subtitle: "Interactive Browser-Based Practice"
format:
  html:
    toc: true
    toc-depth: 2
    number-sections: true
    theme: cosmo
    code-fold: false
filters:
  - webr
webr:
  packages: ['readr', 'dplyr', 'ggplot2']
  show-startup-message: false
---

```{r}
#| echo: false
#| message: false
library(webexercises)
```

# Welcome

This interactive page lets you practice ANOVA directly in your browser - no installation required!

::: {.callout-tip}
## How to Use This Page

1. **Run the setup code first** - this loads the data
2. **Work through the exercises** - edit code and click "Run Code"
3. **Experiment freely** - you can't break anything!
4. **Refer back to slides** - use this alongside the instructor demonstration
:::

```{webr-r}
#| context: setup
#| autorun: true

# Load the study techniques data
library(readr)
data_url <- "https://raw.githubusercontent.com/LittleMonkeyLab/datarepo/main/study_techniques.csv"
study_data <- read_csv(data_url, show_col_types = FALSE)
cat("Data loaded: 120 participants, 3 study methods × 2 time periods")
```

---

# Part 1: Exploring the Data

## View the Data

```{webr-r}
library(readr)
data_url <- "https://raw.githubusercontent.com/LittleMonkeyLab/datarepo/main/study_techniques.csv"
study_data <- read_csv(data_url, show_col_types = FALSE)

head(study_data)
```

## Check the Groups

```{webr-r}
library(readr)
data_url <- "https://raw.githubusercontent.com/LittleMonkeyLab/datarepo/main/study_techniques.csv"
study_data <- read_csv(data_url, show_col_types = FALSE)

table(study_data$method)
```

::: {.callout-note}
## Self-Check

How many participants are in each study method group?

`r mcq(c("20 each", answer = "40 each", "60 each", "80 each"))`
:::

## Factorial Design

```{webr-r}
library(readr)
data_url <- "https://raw.githubusercontent.com/LittleMonkeyLab/datarepo/main/study_techniques.csv"
study_data <- read_csv(data_url, show_col_types = FALSE)

# Cross-tabulation: method × time
table(study_data$method, study_data$time_of_day)
```

---

# Part 2: One-Way ANOVA

## When to Use

Use a **one-way ANOVA** when:

- You have **3 or more groups** to compare
- The outcome variable is **continuous**
- Groups are **independent** (different participants)

## Group Descriptives

```{webr-r}
library(readr)
library(dplyr)
data_url <- "https://raw.githubusercontent.com/LittleMonkeyLab/datarepo/main/study_techniques.csv"
study_data <- read_csv(data_url, show_col_types = FALSE)

study_data |>
  group_by(method) |>
  summarise(
    n = n(),
    mean = round(mean(recall), 2),
    sd = round(sd(recall), 2)
  )
```

## Run the ANOVA

```{webr-r}
library(readr)
data_url <- "https://raw.githubusercontent.com/LittleMonkeyLab/datarepo/main/study_techniques.csv"
study_data <- read_csv(data_url, show_col_types = FALSE)

# Fit one-way ANOVA
model1 <- aov(recall ~ method, data = study_data)
summary(model1)
```

::: {.callout-note}
## Self-Check

What does a significant F-test tell us?

`r mcq(c("Which groups differ from each other", answer = "At least one group differs from the others", "All groups are significantly different"))`
:::

## Visualise the Groups

```{webr-r}
library(readr)
library(ggplot2)
data_url <- "https://raw.githubusercontent.com/LittleMonkeyLab/datarepo/main/study_techniques.csv"
study_data <- read_csv(data_url, show_col_types = FALSE)

ggplot(study_data, aes(x = method, y = recall, fill = method)) +
  geom_boxplot(alpha = 0.7) +
  scale_fill_manual(values = c("Elaboration" = "#3498DB",
                                "Rereading" = "#E74C3C",
                                "Self-Testing" = "#27AE60")) +
  theme_minimal() +
  labs(title = "Recall by Study Method",
       x = "Study Method", y = "Items Recalled") +
  theme(legend.position = "none")
```

---

# Part 3: Post-Hoc Tests

## Why Post-Hoc Tests?

ANOVA tells us IF groups differ, but not WHICH groups differ.

Post-hoc tests make **pairwise comparisons** while controlling for multiple testing.

## Tukey's HSD

```{webr-r}
library(readr)
data_url <- "https://raw.githubusercontent.com/LittleMonkeyLab/datarepo/main/study_techniques.csv"
study_data <- read_csv(data_url, show_col_types = FALSE)

model1 <- aov(recall ~ method, data = study_data)
TukeyHSD(model1)
```

::: {.callout-note}
## Self-Check

In Tukey's output, what does `p adj` mean?

`r mcq(c("Unadjusted p-value", answer = "P-value adjusted for multiple comparisons", "Effect size"))`
:::

## Interpreting the Results

Look for:

- **diff**: Difference between group means
- **p adj**: Adjusted p-value (significant if < .05)
- **lwr, upr**: 95% confidence interval for the difference

::: {.callout-note}
## Self-Check

If the confidence interval includes 0, the difference is:

`r mcq(c("Significant", answer = "Not significant", "Large"))`
:::

---

# Part 4: Two-Way ANOVA

## When to Use

Use a **two-way ANOVA** when:

- You have **two categorical predictors**
- You want to test **main effects** and an **interaction**

## Factorial Design

Our design: 3 methods × 2 times = 6 cells

```{webr-r}
library(readr)
library(dplyr)
data_url <- "https://raw.githubusercontent.com/LittleMonkeyLab/datarepo/main/study_techniques.csv"
study_data <- read_csv(data_url, show_col_types = FALSE)

# Cell means
study_data |>
  group_by(method, time_of_day) |>
  summarise(
    n = n(),
    mean = round(mean(recall), 2),
    .groups = "drop"
  )
```

## Run Two-Way ANOVA

```{webr-r}
library(readr)
data_url <- "https://raw.githubusercontent.com/LittleMonkeyLab/datarepo/main/study_techniques.csv"
study_data <- read_csv(data_url, show_col_types = FALSE)

# Two-way ANOVA with interaction
model2 <- aov(recall ~ method * time_of_day, data = study_data)
summary(model2)
```

::: {.callout-note}
## Self-Check

In `aov(y ~ A * B)`, what does the `*` include?

`r mcq(c("Only main effects", "Only the interaction", answer = "Main effects AND interaction"))`
:::

## Interaction Plot

```{webr-r}
library(readr)
data_url <- "https://raw.githubusercontent.com/LittleMonkeyLab/datarepo/main/study_techniques.csv"
study_data <- read_csv(data_url, show_col_types = FALSE)

# Base R interaction plot
interaction.plot(study_data$time_of_day, study_data$method,
                 study_data$recall,
                 type = "b",
                 xlab = "Time of Day",
                 ylab = "Mean Recall",
                 col = c("blue", "red", "green"),
                 lwd = 2)
```

::: {.callout-note}
## Self-Check

Parallel lines in an interaction plot indicate:

`r mcq(c(answer = "No interaction", "A significant interaction", "An error in the analysis"))`
:::

---

# Part 5: Effect Sizes

## Eta-Squared (η²)

Proportion of variance explained by the factor.

```{webr-r}
library(readr)
data_url <- "https://raw.githubusercontent.com/LittleMonkeyLab/datarepo/main/study_techniques.csv"
study_data <- read_csv(data_url, show_col_types = FALSE)

model1 <- aov(recall ~ method, data = study_data)
model_summary <- summary(model1)

ss_method <- model_summary[[1]]["method", "Sum Sq"]
ss_residual <- model_summary[[1]]["Residuals", "Sum Sq"]
ss_total <- ss_method + ss_residual

eta_sq <- ss_method / ss_total
cat("Eta-squared =", round(eta_sq, 3))
```

## Interpreting Eta-Squared

| η² value | Interpretation |
|----------|----------------|
| 0.01 | Small |
| 0.06 | Medium |
| 0.14 | Large |

::: {.callout-note}
## Self-Check

An eta-squared of 0.28 would be considered:

`r mcq(c("Small", "Medium", answer = "Large"))`
:::

## Partial Eta-Squared for Two-Way

```{webr-r}
library(readr)
data_url <- "https://raw.githubusercontent.com/LittleMonkeyLab/datarepo/main/study_techniques.csv"
study_data <- read_csv(data_url, show_col_types = FALSE)

model2 <- aov(recall ~ method * time_of_day, data = study_data)
summary2 <- summary(model2)

ss_method <- summary2[[1]]["method", "Sum Sq"]
ss_error <- summary2[[1]]["Residuals", "Sum Sq"]

partial_eta <- ss_method / (ss_method + ss_error)
cat("Partial eta-squared for method:", round(partial_eta, 3))
```

---

# Knowledge Check

::: {.webex-check .webex-box}

**1. When should you use ANOVA instead of a t-test?**

`r mcq(c("When comparing 2 groups", answer = "When comparing 3 or more groups", "When you have paired data"))`

**2. What test follows a significant ANOVA?**

`r mcq(c("Another ANOVA", answer = "Post-hoc tests (e.g., Tukey's HSD)", "A regression"))`

**3. True or False: A significant interaction means the main effects are not interpretable on their own.**

`r torf(TRUE)`

**4. What effect size is commonly used with ANOVA?**

`r fitb("eta-squared", ignore_case = TRUE)`

:::

---

# Quick Reference

| Test Type | R Function |
|-----------|------------|
| One-Way ANOVA | `aov(y ~ factor, data = df)` |
| Two-Way ANOVA | `aov(y ~ A * B, data = df)` |
| Post-Hoc | `TukeyHSD(model)` |
| Effect Size | `SS_effect / SS_total` |

---

## Next Steps

1. Return to the activity pages for more detailed practice
2. Complete the **exercise notebook** in RStudio Server
3. Try the **follow-on exercise** for extra practice
