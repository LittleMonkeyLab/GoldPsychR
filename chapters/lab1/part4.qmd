---
title: "Part 4: Descriptives & Plots"
subtitle: "Lab 1: Descriptive Statistics"
format: html
filters:
  - webr
webr:
  packages: ['readr', 'dplyr', 'ggplot2']
  show-startup-message: false
---

```{r, echo = FALSE}
knitr::opts_chunk$set(echo = FALSE)
```

## Watch the Demo

Follow along with the slides below.

```{=html}
<iframe src="part4-slides.html" width="100%" height="500px" style="border: 1px solid #ccc; border-radius: 8px;"></iframe>
```

::: {.callout-tip}
## Tip
Click inside the slide area first, then use arrow keys to navigate.
:::

---

## Try It Yourself

::: {.callout-tip}
## How to Practice
1. **Run the code** to see statistics and plots
2. **Modify** the grouping variables and aesthetics
3. **Copy to RStudio** for your assignment
:::

### Setup: Load Everything

```{webr-r}
# Load packages
library(readr)
library(dplyr)
library(ggplot2)

# Load and prepare data
data_url <- "https://raw.githubusercontent.com/LittleMonkeyLab/datarepo/main/personality_lab.csv"
data <- read_csv(data_url, show_col_types = FALSE)

# Create score (from Part 3)
data$rev_p4 <- 6 - data$p4
data$rev_p5 <- 6 - data$p5
data$pers_score <- data$p1 + data$p2 + data$p3 + data$rev_p4 + data$rev_p5

cat("Ready! Data has", nrow(data), "rows and pers_score column.")
```

### Basic Statistics

Calculate mean, SD, and n:

```{webr-r}
library(readr)
data_url <- "https://raw.githubusercontent.com/LittleMonkeyLab/datarepo/main/personality_lab.csv"
data <- read_csv(data_url, show_col_types = FALSE)
data$rev_p4 <- 6 - data$p4
data$rev_p5 <- 6 - data$p5
data$pers_score <- data$p1 + data$p2 + data$p3 + data$rev_p4 + data$rev_p5

# Overall statistics
cat("Mean:", round(mean(data$pers_score), 2), "\n")
cat("SD:", round(sd(data$pers_score), 2), "\n")
cat("N:", length(data$pers_score), "\n")
```

### Grouped by One Variable

Statistics by group:

```{webr-r}
library(readr)
library(dplyr)
data_url <- "https://raw.githubusercontent.com/LittleMonkeyLab/datarepo/main/personality_lab.csv"
data <- read_csv(data_url, show_col_types = FALSE)
data$rev_p4 <- 6 - data$p4
data$rev_p5 <- 6 - data$p5
data$pers_score <- data$p1 + data$p2 + data$p3 + data$rev_p4 + data$rev_p5

data |>
  group_by(group) |>
  summarise(
    mean = mean(pers_score, na.rm = TRUE),
    sd = sd(pers_score, na.rm = TRUE),
    n = n()
  )
```

::: {.callout-note}
## Challenge
Change `group_by(group)` to `group_by(time)` and run again.
:::

### Grouped by Two Variables

This is what we need for our research question:

```{webr-r}
library(readr)
library(dplyr)
data_url <- "https://raw.githubusercontent.com/LittleMonkeyLab/datarepo/main/personality_lab.csv"
data <- read_csv(data_url, show_col_types = FALSE)
data$rev_p4 <- 6 - data$p4
data$rev_p5 <- 6 - data$p5
data$pers_score <- data$p1 + data$p2 + data$p3 + data$rev_p4 + data$rev_p5

data_summary <- data |>
  group_by(group, time) |>
  summarise(
    mean = mean(pers_score, na.rm = TRUE),
    sd = sd(pers_score, na.rm = TRUE),
    n = n(),
    .groups = "drop"
  )

data_summary
```

### Simple Boxplot

```{webr-r}
library(readr)
library(ggplot2)
data_url <- "https://raw.githubusercontent.com/LittleMonkeyLab/datarepo/main/personality_lab.csv"
data <- read_csv(data_url, show_col_types = FALSE)
data$rev_p4 <- 6 - data$p4
data$rev_p5 <- 6 - data$p5
data$pers_score <- data$p1 + data$p2 + data$p3 + data$rev_p4 + data$rev_p5

ggplot(data, aes(x = group, y = pers_score)) +
  geom_boxplot()
```

### Boxplot with Fill

Add time as a fill colour:

```{webr-r}
library(readr)
library(ggplot2)
data_url <- "https://raw.githubusercontent.com/LittleMonkeyLab/datarepo/main/personality_lab.csv"
data <- read_csv(data_url, show_col_types = FALSE)
data$rev_p4 <- 6 - data$p4
data$rev_p5 <- 6 - data$p5
data$pers_score <- data$p1 + data$p2 + data$p3 + data$rev_p4 + data$rev_p5

ggplot(data, aes(x = group, y = pers_score, fill = time)) +
  geom_boxplot(alpha = 0.7)
```

### Publication-Ready Plot

```{webr-r}
library(readr)
library(ggplot2)
data_url <- "https://raw.githubusercontent.com/LittleMonkeyLab/datarepo/main/personality_lab.csv"
data <- read_csv(data_url, show_col_types = FALSE)
data$rev_p4 <- 6 - data$p4
data$rev_p5 <- 6 - data$p5
data$pers_score <- data$p1 + data$p2 + data$p3 + data$rev_p4 + data$rev_p5

ggplot(data, aes(x = group, y = pers_score, fill = time)) +
  geom_boxplot(alpha = 0.7) +
  theme_minimal() +
  labs(
    title = "Personality Scores by Group and Time",
    x = "Group",
    y = "Personality Score",
    fill = "Timepoint"
  )
```

::: {.callout-note}
## Challenge
Try changing `theme_minimal()` to `theme_classic()` or `theme_bw()`.
:::

---

## Self-Assessment

Check your understanding before moving on.

::: {.webex-check .webex-box}

**1. What does `na.rm = TRUE` do?**

`r mcq(c("Removes all data", answer = "Ignores missing values in calculations", "Creates missing values", "Removes the function"))`

**2. The pipe operator in R is written as: `r fitb("|>")`**

**3. To calculate statistics by group, we use `group_by()` followed by:**

`r mcq(c("filter()", "mutate()", answer = "summarise()", "select()"))`

**4. In ggplot2, `fill = time` means:**

`r mcq(c("Fill the plot with time data", answer = "Colour boxes by the time variable", "Remove the time variable", "Create a time axis"))`

**5. True or False: The pipe |> passes data from left to right.**

`r torf(TRUE)`

:::

---

## Download Exercise

Continue practicing in RStudio:

```{r}
#| echo: false
downloadthis::download_file(
  path = "../../templates/lab1-exercise.qmd",
  output_name = "lab1-exercise",
  button_label = "Download Exercise (.qmd)",
  button_type = "warning",
  icon = "fa fa-download",
  class = "btn-lg"
)
```

---

## Next Steps

::: {.d-flex .justify-content-between}
[← Back to Part 3](part3.qmd){.btn .btn-secondary}

[Continue to Part 5: APA Write-Up →](part5.qmd){.btn .btn-primary}
:::
